use std::str::FromStr;

/// 科目枚举
#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]
pub enum Subject {
    语文,
    数学,
    英语,
    物理,
    化学,
    生物,
    历史,
    政治,
    地理,
    科学,
}

impl Subject {
    /// 获取科目代码
    pub fn to_code(&self) -> i16 {
        match self {
            Self::语文 => 53,
            Self::数学 => 54,
            Self::英语 => 55,
            Self::物理 => 56,
            Self::化学 => 57,
            Self::生物 => 58,
            Self::历史 => 59,
            Self::政治 => 60,
            Self::地理 => 61,
            Self::科学 => 62,
        }
    }

    /// 获取试卷子类型的 itemValue
    /// 
    /// 这里统一了所有科目的逻辑，避免分散在不同的函数中
    pub fn get_subtype_value(&self, subtype_name: &str) -> Option<&'static str> {
        // 部分类型是全科目通用的，可以在这里优先匹配
        match subtype_name {
            "自研" => return Some("1"),
            _ => {}
        }

        match (self, subtype_name) {
            // ==================== 语文 (53) ====================
            (Self::语文, "中考真题") => Some("3551"),
            (Self::语文, "中考模拟") => Some("3553"),
            (Self::语文, "学业考试") => Some("35515"),
            (Self::语文, "自主招生") => Some("3552"),
            (Self::语文, "小初衔接") => Some("35516"),
            (Self::语文, "初高衔接") => Some("35513"),
            (Self::语文, "期中考试") => Some("3556"),
            (Self::语文, "期末考试") => Some("3555"),
            (Self::语文, "单元测试") => Some("3559"),
            (Self::语文, "开学考试") => Some("3558"),
            (Self::语文, "月考") => Some("3557"),
            (Self::语文, "周测") => Some("5502"),
            (Self::语文, "课堂闭环") => Some("35514"),
            (Self::语文, "阶段测试") => Some("35510"),
            (Self::语文, "教材") => Some("5514"),
            (Self::语文, "教辅") => Some("5515"),
            (Self::语文, "竞赛") => Some("35511"),

            // ==================== 数学 (54) ====================
            (Self::数学, "中考真题") => Some("3541"),
            (Self::数学, "中考模拟") => Some("3543"),
            (Self::数学, "学业考试") => Some("35415"),
            (Self::数学, "自主招生") => Some("3542"),
            (Self::数学, "小初衔接") => Some("35416"),
            (Self::数学, "初高衔接") => Some("35413"),
            (Self::数学, "期中考试") => Some("3546"),
            (Self::数学, "期末考试") => Some("3545"),
            (Self::数学, "单元测试") => Some("3549"),
            (Self::数学, "开学考试") => Some("3548"),
            (Self::数学, "月考") => Some("3547"),
            (Self::数学, "周测") => Some("542"),
            (Self::数学, "课堂闭环") => Some("35414"),
            (Self::数学, "阶段测试") => Some("35410"),
            (Self::数学, "教材") => Some("5414"),
            (Self::数学, "教辅") => Some("5415"),
            (Self::数学, "竞赛") => Some("35411"),

            // ==================== 英语 (55) ====================
            (Self::英语, "中考真题") => Some("3531"),
            (Self::英语, "中考模拟") => Some("3533"),
            (Self::英语, "学业考试") => Some("35315"),
            (Self::英语, "自主招生") => Some("3532"),
            (Self::英语, "小初衔接") => Some("35316"),
            (Self::英语, "初高衔接") => Some("35313"),
            (Self::英语, "期中考试") => Some("3536"),
            (Self::英语, "期末考试") => Some("3535"),
            (Self::英语, "单元测试") => Some("3539"),
            (Self::英语, "开学考试") => Some("3538"),
            (Self::英语, "月考") => Some("3537"),
            (Self::英语, "周测") => Some("41"),
            (Self::英语, "课堂闭环") => Some("35314"),
            (Self::英语, "阶段测试") => Some("35310"),
            (Self::英语, "教材") => Some("53"),
            (Self::英语, "教辅") => Some("54"),
            (Self::英语, "竞赛") => Some("35311"),
            
            // ==================== 物理 (56) ====================
            (Self::物理, "中考真题") => Some("3561"),
            (Self::物理, "中考模拟") => Some("3563"),
            (Self::物理, "学业考试") => Some("35615"),
            (Self::物理, "自主招生") => Some("3562"),
            (Self::物理, "小初衔接") => Some("35616"),
            (Self::物理, "初高衔接") => Some("35613"),
            (Self::物理, "期中考试") => Some("3566"),
            (Self::物理, "期末考试") => Some("3565"),
            (Self::物理, "单元测试") => Some("3569"),
            (Self::物理, "开学考试") => Some("3568"),
            (Self::物理, "月考") => Some("3567"),
            (Self::物理, "周测") => Some("5602"),
            (Self::物理, "课堂闭环") => Some("35614"),
            (Self::物理, "阶段测试") => Some("35610"),
            (Self::物理, "教材") => Some("5614"),
            (Self::物理, "教辅") => Some("5615"),
            (Self::物理, "竞赛") => Some("35611"),
            
            // ==================== 化学 (57) ====================
            (Self::化学, "中考真题") => Some("3571"),
            (Self::化学, "中考模拟") => Some("3573"),
            (Self::化学, "学业考试") => Some("35715"),
            (Self::化学, "自主招生") => Some("3572"),
            (Self::化学, "小初衔接") => Some("35716"),
            (Self::化学, "初高衔接") => Some("35713"),
            (Self::化学, "期中考试") => Some("3576"),
            (Self::化学, "期末考试") => Some("3575"),
            (Self::化学, "单元测试") => Some("3579"),
            (Self::化学, "开学考试") => Some("3578"),
            (Self::化学, "月考") => Some("3577"),
            (Self::化学, "周测") => Some("5702"),
            (Self::化学, "课堂闭环") => Some("35714"),
            (Self::化学, "阶段测试") => Some("35710"),
            (Self::化学, "教材") => Some("5714"),
            (Self::化学, "教辅") => Some("5715"),
            (Self::化学, "竞赛") => Some("35711"),
            
            // ==================== 生物 (58) ====================
            (Self::生物, "中考真题") => Some("3581"),
            (Self::生物, "中考模拟") => Some("3583"),
            (Self::生物, "学业考试") => Some("35815"),
            (Self::生物, "自主招生") => Some("3582"),
            (Self::生物, "小初衔接") => Some("35816"),
            (Self::生物, "初高衔接") => Some("35813"),
            (Self::生物, "期中考试") => Some("3586"),
            (Self::生物, "期末考试") => Some("3585"),
            (Self::生物, "单元测试") => Some("3589"),
            (Self::生物, "开学考试") => Some("3588"),
            (Self::生物, "月考") => Some("3587"),
            (Self::生物, "周测") => Some("5802"),
            (Self::生物, "课堂闭环") => Some("35814"),
            (Self::生物, "阶段测试") => Some("35810"),
            (Self::生物, "教材") => Some("5814"),
            (Self::生物, "教辅") => Some("5815"),
            (Self::生物, "竞赛") => Some("35811"),
            
            // ==================== 历史 (59) ====================
            (Self::历史, "中考真题") => Some("3611"),
            (Self::历史, "中考模拟") => Some("3613"),
            (Self::历史, "学业考试") => Some("36115"),
            (Self::历史, "自主招生") => Some("3612"),
            (Self::历史, "小初衔接") => Some("36116"),
            (Self::历史, "初高衔接") => Some("36113"),
            (Self::历史, "期中考试") => Some("3616"),
            (Self::历史, "期末考试") => Some("3615"),
            (Self::历史, "单元测试") => Some("3619"),
            (Self::历史, "开学考试") => Some("3618"),
            (Self::历史, "月考") => Some("3617"),
            (Self::历史, "周测") => Some("6102"),
            (Self::历史, "课堂闭环") => Some("36114"),
            (Self::历史, "阶段测试") => Some("36110"),
            (Self::历史, "教材") => Some("6114"),
            (Self::历史, "教辅") => Some("6115"),
            (Self::历史, "竞赛") => Some("36111"),
            
            // ==================== 政治 (60) ====================
            (Self::政治, "中考真题") => Some("3601"),
            (Self::政治, "中考模拟") => Some("3603"),
            (Self::政治, "学业考试") => Some("36015"),
            (Self::政治, "自主招生") => Some("3602"),
            (Self::政治, "小初衔接") => Some("36016"),
            (Self::政治, "初高衔接") => Some("36013"),
            (Self::政治, "期中考试") => Some("3606"),
            (Self::政治, "期末考试") => Some("3605"),
            (Self::政治, "单元测试") => Some("3609"),
            (Self::政治, "开学考试") => Some("3608"),
            (Self::政治, "月考") => Some("3607"),
            (Self::政治, "周测") => Some("6002"),
            (Self::政治, "课堂闭环") => Some("36014"),
            (Self::政治, "阶段测试") => Some("36010"),
            (Self::政治, "教材") => Some("6014"),
            (Self::政治, "教辅") => Some("6015"),
            (Self::政治, "竞赛") => Some("36011"),
            
            // ==================== 地理 (61) ====================
            (Self::地理, "中考真题") => Some("3591"),
            (Self::地理, "中考模拟") => Some("3593"),
            (Self::地理, "学业考试") => Some("35915"),
            (Self::地理, "自主招生") => Some("3592"),
            (Self::地理, "小初衔接") => Some("35916"),
            (Self::地理, "初高衔接") => Some("35913"),
            (Self::地理, "期中考试") => Some("3596"),
            (Self::地理, "期末考试") => Some("3595"),
            (Self::地理, "单元测试") => Some("3599"),
            (Self::地理, "开学考试") => Some("3598"),
            (Self::地理, "月考") => Some("3597"),
            (Self::地理, "周测") => Some("5902"),
            (Self::地理, "课堂闭环") => Some("35914"),
            (Self::地理, "阶段测试") => Some("35910"),
            (Self::地理, "教材") => Some("5914"),
            (Self::地理, "教辅") => Some("5915"),
            (Self::地理, "竞赛") => Some("35911"),
            
            // ==================== 科学 (62) ====================
            (Self::科学, "中考真题") => Some("3621"),
            (Self::科学, "中考模拟") => Some("3623"),
            (Self::科学, "学业考试") => Some("36215"),
            (Self::科学, "自主招生") => Some("3622"),
            (Self::科学, "小初衔接") => Some("36216"),
            (Self::科学, "初高衔接") => Some("36213"),
            (Self::科学, "期中考试") => Some("3626"),
            (Self::科学, "期末考试") => Some("3625"),
            (Self::科学, "单元测试") => Some("3629"),
            (Self::科学, "开学考试") => Some("3628"),
            (Self::科学, "月考") => Some("3627"),
            (Self::科学, "周测") => Some("6202"),
            (Self::科学, "课堂闭环") => Some("36214"),
            (Self::科学, "阶段测试") => Some("36210"),
            (Self::科学, "教材") => Some("6214"),
            (Self::科学, "教辅") => Some("6215"),
            (Self::科学, "竞赛") => Some("36211"),
            
            _ => None,
        }
    }
}


impl FromStr for Subject {
    type Err = ();

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        match s {
            "语文" => Ok(Self::语文),
            "数学" => Ok(Self::数学),
            "英语" => Ok(Self::英语),
            "物理" => Ok(Self::物理),
            "化学" => Ok(Self::化学),
            "生物" => Ok(Self::生物),
            "历史" => Ok(Self::历史),
            "政治" => Ok(Self::政治),
            "地理" => Ok(Self::地理),
            "科学" => Ok(Self::科学),
            _ => Err(()),
        }
    }
}

/// 试卷大类（父类型）
/// 建议将这些字符串常量也封装起来，防止拼写错误
#[derive(serde::Serialize)]
pub enum PaperCategory {
    ZhongKaoZhuanTi,   // 中考专题
    KuaXueDuan,        // 跨学段衔接
    JieDuanCeShi,      // 阶段测试
    ZiYan,             // 新东方自研
    JingSai,           // 竞赛
}

impl PaperCategory {
    /// 从中文名称获取 itemValue
    pub fn get_value(name: &str) -> Option<&'static str> {
        match name {
            "中考专题" => Some("ppt1"),
            "跨学段衔接" => Some("ppt2"),
            "阶段测试" => Some("ppt3"),
            "新东方自研" => Some("ppt4"),
            "竞赛" => Some("ppt5"),
            _ => None,
        }
    }
}

impl FromStr for PaperCategory {
    type Err = ();

    fn from_str(s: &str) -> Result<Self, Self::Err> {
        match s {
            "中考专题" => Ok(Self::ZhongKaoZhuanTi),
            "跨学段衔接" => Ok(Self::KuaXueDuan),
            "阶段测试" => Ok(Self::JieDuanCeShi),
            "新东方自研" => Ok(Self::ZiYan),
            "竞赛" => Ok(Self::JingSai),
            _ => Err(()),
        }
    }
}

// ==================== 对外暴露的便捷函数 ====================

/// 根据科目名称和子类型名称获取 itemValue
/// 
/// # 示例
/// ```
/// let val = get_subtype_value_by_name("数学", "期中考试"); // Some("3546")
/// ```
pub fn get_subtype_value_by_name(subject_name: &str, subtype_name: &str) -> Option<&'static str> {
    // 尝试将字符串解析为 Subject 枚举，如果成功则调用方法
    if let Ok(subject) = subject_name.parse::<Subject>() {
        subject.get_subtype_value(subtype_name)
    } else {
        None
    }
}

